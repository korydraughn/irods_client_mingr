<!doctype html>
<html>
    <head>
        <title>{{ title }} - MinGR</title>

        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    </head>

    <body>
        <h1>Minimalist GUI for iRODS - {{ title }}</h1>

        <div class="flex-container">
            <div class="flex-item">{% include "nav.html" %}</div>

            <div class="flex-item">
                <h2>Current Working Collection: {{ current_collection }}</h2>

                <form action="{{ url_for('filesystem') }}" method="get">
                    <label>Change Collection To: </label>
                    <input name="collection" type="text" value="{{ current_collection }}" required />
                    <button>Go</button>
                </form>

                <div>
                    <h3>Collections</h3>

                    {% if collections %}
                    <ul>
                        {% for id, c in collections %}
                        <li>{{ c }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>- No collections found - </p>
                    {% endif %}
                </div>

                <div>
                    <h3>Data Objects</h3>

                    {% if data_objects %}
                    <table>
                        <tr>
                            <th style="text-align: start; padding-right: 5em;">Name</th>
                            <th style="text-align: start;">Size</th>
                            <th>Action</th>
                        </tr>
                        {% for id, _, dn, sz in data_objects %}
                        <tr>
                            <td>{{ dn }}</td>
                            <td style="text-align: end;">{{ sz }}</td>
                            <td><button id="view_details" data-irods-data-id="{{ id }}">View</button></td>
                            <td><button id="delete" data-irods-data-id="{{ id }}">Delete</button></td>
                        </tr>
                        {% endfor %}
                    </table>

                    <form id="for_data_object_info" action="/data-object-info" method="get" hidden>
                        <input name="data_id" type="text" required />
                        <button></button>
                    </form>
                    {% else %}
                    <p>- No data objects found - </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </body>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script>
        "use strict";

        $(function() {
            $("button#view_details").on("click", function() {
                console.log('clicked view details button!');

                // Find the data id associated with the table row and submit
                // a request to fetch the details of the data object.
                var id = $(this).data('irods-data-id');
                console.log('view details id = ' + id);

                var $form = $('form#for_data_object_info');
                $form.find('input').val(id);
                $form.trigger('submit');
            });

            $("button#delete").on("click", function() {
                console.log('clicked delete button!');

                // Find the data id associated with the table row and submit
                // a request to fetch the details of the data object.
                var id = $(this).data('irods-data-id');
                console.log('delete id = ' + id);
            });
        });
    </script>
</html>
